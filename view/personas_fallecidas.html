{include="header"}

<div class="container-fluid">
  <!-- Encabezado --->
  <div class="row">
      <div class="col-sm-8 col-xs-6">
         <div class="btn-group hidden-xs">
            <a class="btn btn-sm btn-default" href="" title="Recargar la página">
               <span class="glyphicon glyphicon-refresh"></span>
            </a>
         </div>
         <div class="btn-group">
            <a class="btn btn-sm btn-success" data-toggle="modal" data-target="#modal_persona_fallecida" href="#">
               <span class="glyphicon glyphicon-plus"></span><span class="hidden-xs">&nbsp;Nueva</span>
            </a>
         </div>
      </div>
  </div>
  <!--- Tabla, vista de datos -->
  <div class="table-responsive">
     <table class="table table-hover">
        <thead>
           <tr>
              <th></th>
              <th></th>
              <th class="text-left">Nombres y apellido</th>
              <th class="text-left">Fecha de defunción</th>
              <th class="text-left">Cementerio</th>
              <th class="text-left">Servicio religioso</th>
              <th></th>
           </tr>
        </thead>
        <tbody>
          {loop="$fsc->personasFallecidas"}
          <tr id="r_{$value['id']}">
            <th></th>
            <th></th>
            <th>{$value['Nombre']} {$value['Apellido']}</th>
            <th>{$value['Fecha_defuncion']}</th>
            <th>{$value['lugar_cementerio']}</th>
            <th>{$value['servicio_religioso']}</th>
            <th>
              <a class="btn btn-sm btn-danger btn_borrar" href="#" data_id="{$value['id']}"><span class="glyphicon glyphicon-trash"></span></a>
              <a class="btn btn-sm btn-primary" href="{$fsc->urlEditar}"><span class="glyphicon glyphicon-pencil"></span></a>
              <a class="btn btn-sm btn-primary" href="{$fsc->urlVer}&id={$value['id']}"><span class="glyphicon glyphicon-eye-open"></span></a>
            </th>
          </tr>
          {/loop}
        </tbody>
      </table>
    </div>
    <!-- modal de formulario para agregar y editar -->
    <form name="f_persona_fallecida" class="form" action="{$fsc->urlGuardar}" method="post">
        <div class="modal" id="modal_persona_fallecida">
            <div class="modal-dialog" style="width:800px;">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-search"></span>
                            &nbsp; Información de la persona fallecida
                        </h4>
                    </div>

                    <div class="modal-body">
                      <ul class="nav nav-tabs">
                          <li class="active"><a data-toggle="tab" href="#sectionA">Datos personales</a></li>
                          <li><a data-toggle="tab" href="#sectionB">Datos defunción</a></li>
                          <li><a data-toggle="tab" href="#sectionC">Datos cementerio</a></li>
                          <li><a data-toggle="tab" href="#sectionD">Datos servicio</a></li>
                      </ul>

                      <div class="tab-content">
                          <div id="sectionA" class="tab-pane fade in active">
                              <div class="form-group">
                                <div class="input-group">
                                  <label>identificación:</label>
                                  <input class="form-control" type="text" name="identificacion" id="identificacion" placeholder="35.123.413" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Nombres</label>
                                  <input class="form-control" type="text" name="nombre" id="nombre" placeholder="Juan" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Apellido</label>
                                  <input class="form-control" type="text" name="apellido" id="apellido" placeholder="Perez" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Fecha de nacimiento:</label>
                                  <input class="form-control" type="date" name="fecha_nacimiento" id="fecha_nacimiento" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Edad:</label>
                                  <input class="form-control" type="number" name="edad" id="edad" placeholder="92" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Provincia:</label>
                                  <input class="form-control" type="text" name="edad" id="provincia" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Ciudad:</label>
                                  <input class="form-control" type="text" name="edad" id="ciudad" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Nacionalidad:</label>
                                  <input class="form-control" type="text" name="edad" id="nacionalidad" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Estado civil:</label>
                                  <select class="form-control" type="text" name="estado_civil" id="estado_civil" placeholder="" autocomplete="off"/>
                                    <option value="CASADO/A"> Casado/a </option>
                                    <option value="SOLTERO/A"> Soltero/a </option>
                                  </select>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Número Ficha IESS:</label>
                                  <input class="form-control" type="text" name="iess" id="iess" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Apoderado:</label>
                                  <input class="form-control" type="text" name="apoderado" id="apoderado" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                          </div>
                          <div id="sectionB" class="tab-pane fade">
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Fecha:</label>
                                  <input class="form-control" type="date" name="fecha_defuncion" id="fecha_defuncion" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Hora:</label>
                                  <input class="form-control" type="time" name="hora_defuncion" id="hora_defuncion" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Causa:</label>
                                  <input class="form-control" type="text" name="causa_defuncion" id="causa_defuncion" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Hospital:</label>
                                  <input class="form-control" type="text" name="hospital_defuncion" id="hospital_defuncion" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Lugar de fallecimiento:</label>
                                  <input class="form-control" type="text" name="lugar_defuncion" id="lugar_defuncion" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                          </div>
                          <div id="sectionC" class="tab-pane fade">
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Lugar:</label>
                                  <input class="form-control" type="text" name="lugar_cementerio" id="lugar_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Tomo:</label>
                                  <input class="form-control" type="text" name="tomo_cementerio" id="tomo_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Acta:</label>
                                  <input class="form-control" type="text" name="acta_cementerio" id="acta_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Folio:</label>
                                  <input class="form-control" type="text" name="folio_cementerio" id="folio_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Valor:</label>
                                  <input class="form-control" type="text" name="valor_cementerio" id="valor_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Observaciones:</label>
                                  <input class="form-control" type="text" name="observaciones_cementerio" id="observaciones_cementerio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                          </div>
                          <div id="sectionD" class="tab-pane fade">
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Servicio religioso:</label>
                                  <input class="form-control" type="text" name="servicio_religioso" id="servicio_religioso" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Horario de misa:</label>
                                  <input class="form-control" type="time" name="horario_misa" id="horario_misa" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Lugar velatorio:</label>
                                  <input class="form-control" type="text" name="lugar_velatorio" id="lugar_velatorio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="input-group">
                                  <label>Hora sepelio:</label>
                                  <input class="form-control" type="time" name="hora_sepelio" id="hora_sepelio" placeholder="" autocomplete="off"/>
                                </div>
                              </div>
                          </div>
                      </div>

                    </div>
                    <div class="modal-body bg-info">
                        <div class="row">
                          <div class="col-sm-5 text-right">
                              <button class="btn btn-sm btn-primary" type="submit" id="submit-btn">
                                  <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
                              </button>
                          </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </form>
</div>

<!-- JavaScript de la vista -->
<script>
  $(document).ready(function(){
    $('.btn_borrar').on('click', function(){
      let Id = $(this).attr('data_id');
      $.post("{$fsc->urlBorrar}",{id:Id})
      .done(function(d){
        d = JSON.parse(d);
        if (d['success']){
          $('#r_'+Id).remove();
        }
      })
      .fail(function(){
        alert('Ocurrió un error al intentar borrar el elemento');
      });
    })
  });
</script>

{include="footer"}
